<!DOCTYPE html>
<html>
<head>
    <title>AutoComplete Demo</title>
    <style>
        textarea {font-size: 14px; width: 500px; height: 800px;}
    </style>
</head>

<body>

<textarea id="code">
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
    lalala;
    var foo = function(){};
    foo.prototype.bar = function(arg1, arg2){};

    var scope1 = function(){
        var foo = function(){};
        var bar = {};
        bar.ccc = {};

        foo.prototype.another = function(arg3, arg4){
            var bar = {};
            bar.abc = {};

            bar;
            foo;
        };

        bar;

    };

    var scope2 = function(){
        foo;
    };

    foo;
</textarea>

<script>
    var ac = new Worker('autocomplete.js');
    ac.onmessage = function(e){
        console.log(e);
    };

    var code_input = document.getElementById('code');
    var getLastInputWord = function(input, caret_pos){
        var str = input.value.slice(0, caret_pos);
        var str_arr = str.split(/\s+/);
        return str_arr[str_arr.length - 1];
    };

    code_input.addEventListener('keyup', function(){
        var data = {
            script: code_input.value,
            cursor_pos: code_input.selectionStart
        };
        ac.postMessage(JSON.stringify(data));
    });
</script>
</body>

</html>